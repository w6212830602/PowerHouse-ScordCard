<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ScoreCard.ViewModels"
             xmlns:models="clr-namespace:ScoreCard.Models"
             xmlns:converts="clr-namespace:ScoreCard.Converts"
             x:Class="ScoreCard.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             BackgroundColor="#F8F9FA"
             Title="Settings">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converts:StringEqualsConverter x:Key="StringEqualsConverter"/>
            <converts:BoolToColorConverter x:Key="BoolToColorConverter"/>
            <converts:InverseBoolToColorConverter x:Key="InverseBoolToColorConverter"/>
            <converts:BoolToStringConverter x:Key="BoolToStringConverter"/>
            <converts:InverseBoolToStringConverter x:Key="InverseBoolToStringConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">
        <!-- Header with tabs -->
        <Grid Grid.Row="0" Padding="20,0" BackgroundColor="White">
            <HorizontalStackLayout Spacing="0">
                <!-- Company Target Tab -->
                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        BackgroundColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='CompanyTarget,#EFF6FF,White'}"
                        Padding="20,10">
                    <Label Text="Company Target"
                           TextColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='CompanyTarget,#2563EB,#6B7280'}"
                           FontAttributes="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='CompanyTarget,Bold,None'}"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SwitchTabCommand}" CommandParameter="CompanyTarget"/>
                    </Border.GestureRecognizers>
                </Border>

                <!-- Individual Target Tab -->
                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        BackgroundColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='IndividualTarget,#EFF6FF,White'}"
                        Padding="20,10">
                    <Label Text="Individual Target"
                           TextColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='IndividualTarget,#2563EB,#6B7280'}"
                           FontAttributes="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='IndividualTarget,Bold,None'}"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SwitchTabCommand}" CommandParameter="IndividualTarget"/>
                    </Border.GestureRecognizers>
                </Border>

                <!-- LOB Targets Tab -->
                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        BackgroundColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='LOBTargets,#EFF6FF,White'}"
                        Padding="20,10">
                    <Label Text="LOB Targets"
                           TextColor="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='LOBTargets,#2563EB,#6B7280'}"
                           FontAttributes="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='LOBTargets,Bold,None'}"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SwitchTabCommand}" CommandParameter="LOBTargets"/>
                    </Border.GestureRecognizers>
                </Border>
            </HorizontalStackLayout>
        </Grid>

        <!-- Main content area -->
        <Grid Grid.Row="1" Padding="20">
            <!-- Edit button in top-right corner -->
            <Button Text="Edit Targets"
                    Command="{Binding ToggleEditModeCommand}"
                    TextColor="White"
                    BackgroundColor="#FF3B30"
                    Padding="15,5"
                    HeightRequest="36"
                    HorizontalOptions="End"
                    VerticalOptions="Start"
                    Margin="0,10,0,0"
                    IsVisible="{Binding IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>

            <!-- Save button in edit mode -->
            <Button Text="Save Changes"
                    Command="{Binding SaveChangesCommand}"
                    TextColor="White"
                    BackgroundColor="#10B981"
                    Padding="15,5"
                    HeightRequest="36"
                    HorizontalOptions="End"
                    VerticalOptions="Start"
                    Margin="0,10,0,0"
                    IsVisible="{Binding IsEditingTargets}"/>

            <!-- Company Target Tab Content -->
            <VerticalStackLayout IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='CompanyTarget,True,False'}"
                                 Spacing="20">
                <Label Text="Company Target" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       Margin="0,20,0,0"/>

                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        BackgroundColor="White">
                    <VerticalStackLayout>
                        <!-- Table Header -->
                        <Grid ColumnDefinitions="2*,*,*,*,*,*"
                              BackgroundColor="#F9FAFB"
                              Padding="16,12">
                            <Label Grid.Column="0" Text="Fiscal Year" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Text="Annual Target" FontAttributes="Bold"/>
                            <Label Grid.Column="2" Text="Q1 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="3" Text="Q2 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="4" Text="Q3 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="5" Text="Q4 Target" FontAttributes="Bold"/>
                        </Grid>

                        <!-- Table Content -->
                        <CollectionView ItemsSource="{Binding CompanyTargets}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:FiscalYearTarget">
                                    <Grid ColumnDefinitions="2*,*,*,*,*,*"
                                          Padding="16,12">
                                        <Label Grid.Column="0" Text="{Binding FiscalYear, StringFormat='FY {0}'}"/>

                                        <!-- Targets - conditionally editable -->
                                        <Grid Grid.Column="1">
                                            <Label Text="{Binding AnnualTarget, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding AnnualTarget, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="2">
                                            <Label Text="{Binding Q1Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q1Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="3">
                                            <Label Text="{Binding Q2Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q2Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="4">
                                            <Label Text="{Binding Q3Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q3Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="5">
                                            <Label Text="{Binding Q4Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q4Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>

            <!-- Individual Target Tab Content -->
            <VerticalStackLayout IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='IndividualTarget,True,False'}"
                                 Spacing="20">
                <Grid ColumnDefinitions="*,Auto" Margin="0,20,0,0">
                    <Label Text="Individual Target" 
                           FontSize="20" 
                           FontAttributes="Bold"/>

                    <!-- Add Sales Rep Button -->
                    <Button Grid.Column="1"
                            Text="+ Add Reps"
                            Command="{Binding AddSalesRepCommand}"
                            IsVisible="{Binding IsEditingTargets}"
                            BackgroundColor="#3B82F6"
                            TextColor="White"
                            HeightRequest="36"
                            Padding="15,5"/>
                </Grid>

                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        BackgroundColor="White">
                    <VerticalStackLayout>
                        <!-- Table Header -->
                        <Grid ColumnDefinitions="2*,*,*,*,*,*,Auto"
                              BackgroundColor="#F9FAFB"
                              Padding="16,12">
                            <Label Grid.Column="0" Text="Sales Rep" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Text="Annual Target" FontAttributes="Bold"/>
                            <Label Grid.Column="2" Text="Q1 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="3" Text="Q2 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="4" Text="Q3 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="5" Text="Q4 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="6" Text="Actions" FontAttributes="Bold" IsVisible="{Binding IsEditingTargets}"/>
                        </Grid>

                        <!-- Table Content -->
                        <CollectionView ItemsSource="{Binding SalesRepTargets}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="2*,*,*,*,*,*,Auto"
                                          Padding="16,12">
                                        <Grid Grid.Column="0">
                                            <Label Text="{Binding SalesRep}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding SalesRep}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <!-- Targets - conditionally editable -->
                                        <Grid Grid.Column="1">
                                            <Label Text="{Binding AnnualTarget, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding AnnualTarget, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="2">
                                            <Label Text="{Binding Q1Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q1Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="3">
                                            <Label Text="{Binding Q2Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q2Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="4">
                                            <Label Text="{Binding Q3Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q3Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="5">
                                            <Label Text="{Binding Q4Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q4Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <!-- Edit Actions -->
                                        <Button Grid.Column="6"
                                                Text="✏️"
                                                BackgroundColor="Transparent"
                                                TextColor="#64748B"
                                                FontSize="16"
                                                IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>

            <!-- LOB Targets Tab Content -->
            <VerticalStackLayout IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='LOBTargets,True,False'}"
                                 Spacing="20">
                <Grid ColumnDefinitions="*,Auto" Margin="0,20,0,0">
                    <Label Text="LOB Targets" 
                           FontSize="20" 
                           FontAttributes="Bold"/>

                    <!-- Add LOB Button -->
                    <Button Grid.Column="1"
                            Text="+ Add LOB"
                            Command="{Binding AddLOBCommand}"
                            IsVisible="{Binding IsEditingTargets}"
                            BackgroundColor="#3B82F6"
                            TextColor="White"
                            HeightRequest="36"
                            Padding="15,5"/>
                </Grid>

                <Border Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        BackgroundColor="White">
                    <VerticalStackLayout>
                        <!-- Table Header -->
                        <Grid ColumnDefinitions="2*,*,*,*,*,*,Auto"
                              BackgroundColor="#F9FAFB"
                              Padding="16,12">
                            <Label Grid.Column="0" Text="LOB" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Text="Annual Target" FontAttributes="Bold"/>
                            <Label Grid.Column="2" Text="Q1 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="3" Text="Q2 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="4" Text="Q3 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="5" Text="Q4 Target" FontAttributes="Bold"/>
                            <Label Grid.Column="6" Text="Actions" FontAttributes="Bold" IsVisible="{Binding IsEditingTargets}"/>
                        </Grid>

                        <!-- Table Content -->
                        <CollectionView ItemsSource="{Binding LobTargets}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="2*,*,*,*,*,*,Auto"
                                          Padding="16,12">
                                        <Grid Grid.Column="0">
                                            <Label Text="{Binding LOB}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding LOB}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <!-- Targets - conditionally editable -->
                                        <Grid Grid.Column="1">
                                            <Label Text="{Binding AnnualTarget, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding AnnualTarget, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="2">
                                            <Label Text="{Binding Q1Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q1Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="3">
                                            <Label Text="{Binding Q2Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q2Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="4">
                                            <Label Text="{Binding Q3Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q3Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <Grid Grid.Column="5">
                                            <Label Text="{Binding Q4Target, StringFormat='${0:N0}'}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets, Converter={StaticResource InverseBoolToStringConverter}}"/>
                                            <Entry Text="{Binding Q4Target, StringFormat='{0:N0}'}" 
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"
                                                   Keyboard="Numeric"
                                                   ReturnType="Done"
                                                   ClearButtonVisibility="WhileEditing"/>
                                        </Grid>

                                        <!-- Edit Actions -->
                                        <Button Grid.Column="6"
                                                Text="✏️"
                                                BackgroundColor="Transparent"
                                                TextColor="#64748B"
                                                FontSize="16"
                                                IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=IsEditingTargets}"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>

            <!-- Loading indicator -->
            <Grid BackgroundColor="#80000000" 
                  IsVisible="{Binding IsLoading}">
                <ActivityIndicator IsRunning="{Binding IsLoading}" 
                                  Color="#FF3B30"
                                  HeightRequest="50" 
                                  WidthRequest="50"
                                  HorizontalOptions="Center" 
                                  VerticalOptions="Center"/>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>